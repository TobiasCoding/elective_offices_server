{% extends "layout.html" %}
{% block content %}

<h2 data-i18n="app.processed_results">Processed results</h2>

<!-- ================== FILTER BAR (scrollable) ================== -->
<div id="filters-bar">
  <div class="filter-group">
    <div class="filter-label" data-i18n="filters.year">Year</div>
    <div class="filter-scroll" id="filter-year">
      <button class="chip chip-all" data-value="" data-i18n="filters.all">All</button>
      {% for y in years %}
      <button class="chip" data-value="{{ y }}">{{ y }}</button>
      {% endfor %}
    </div>
  </div>

  <div class="filter-group">
    <div class="filter-label" data-i18n="filters.phase">Phase</div>
    <div class="filter-scroll" id="filter-phase">
      <button class="chip chip-all" data-value="" data-i18n="filters.all">All</button>
      {% for p in phases %}
      <button class="chip" data-value="{{ p }}">{{ p }}</button>
      {% endfor %}
    </div>
  </div>
</div>

<!-- ================== TABLE ================== -->
<table id="results-table">
  <thead>
    <tr>
      <!-- Columnas visibles (se eliminaron Calc y Actions) -->
      <th data-i18n="table.category">Category</th>
      <th data-i18n="table.office">Office</th>
      <th data-i18n="table.method">Method</th>
      <th data-i18n="table.last_calc">Last Calc</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr class="data-row" data-year="{{ row.year }}" data-phase="{{ row.election_type }}"
      data-category="{{ row.category }}" data-office="{{ row.office }}" data-method="{{ row.method }}"
      data-pre="{{ 'updated' if row.preprocessed_json else '' }}" data-json-url="{{ row.json_url or '' }}"
      data-seats="{{ row.seats or '' }}">
      <td>{{ row.category }}</td>
      <td>
        <!-- Botón para expandir/ver calc inline -->
        <button class="link-like show-calc" type="button" data-i18n-title="btn.show_calc.title"
          title="Show calc for this entry">
          {{ row.office }}
        </button>
      </td>
      <td>{{ row.method }}</td>
      <td>{{ row.last_calc or '-' }}</td>
    </tr>
    <!-- Fila expandible para contenido de calc; colspan ajustado a 4 tras remover columnas -->
    <tr class="calc-row" style="display:none" data-open="0">
      <td colspan="4">
        <div class="calc-panel">
          <div class="calc-loading" hidden data-i18n="calc.loading">Loading calc…</div>
          <div class="calc-error" hidden data-i18n="calc.error">An error occurred while loading.</div>
          <div class="calc-content" hidden></div>
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Seats context inyectado por el back -->
<script id="seats-ctx" type="application/json">
  {{ seats_ctx_json | default('{}') | safe }}
</script>

<!-- Orden sugerido: prefs -> i18n -> main -->
<script src="static/main.js"></script>
{% endblock %}